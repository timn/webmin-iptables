inside -> firewall {
  # We ignore client ports since some implementations use ports < 1024 and
  # others use > 1023...
  RULE(filter, INPUT, tcp, @INTNET@, IGNORE, @INTIP@, 111, @INTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, ACCEPT, YES)
  RULE(filter, OUTPUT, tcp, @INTIP@, 111, @INTNET@, IGNORE, IGNORE, @INTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, ACCEPT, YES)
  RULE(filter, INPUT, udp, @INTNET@, IGNORE, @INTIP@, 111, @INTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, ACCEPT, YES)
  RULE(filter, OUTPUT, udp, @INTIP@, 111, @INTNET@, IGNORE, IGNORE, @INTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, ACCEPT, YES)

  RULE(filter, INPUT, tcp, @INTNET@, :1023, @INTIP@, 2049, @INTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, ACCEPT, YES)
  RULE(filter, OUTPUT, tcp, @INTIP@, 2049, @INTNET@, :1023, IGNORE, @INTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, NO, ACCEPT, YES)
  RULE(filter, INPUT, udp, @INTNET@, :1023, @INTIP@, 2049, @INTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, ACCEPT, YES)
  RULE(filter, OUTPUT, udp, @INTIP@, 2049, @INTNET@, :1023, IGNORE, @INTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, ACCEPT, YES)

  CONDMULTI-RULE(system, 2, %%MOUNTDPORT%%/usr/sbin/rpcinfo -p | grep mountd | grep tcp | awk '{ print $4 }'%%)
    RULE(filter, INPUT, tcp, @INTNET@, :1023, @INTIP@, @MOUNTDPORT@, @INTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, ACCEPT, YES)
    RULE(filter, OUTPUT, tcp, @INTIP@, @MOUNTDPORT@, @INTNET@, :1023, IGNORE, @INTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, ACCEPT, YES)
  CONDMULTI-RULE(system, 2, %%MOUNTDPORT%%/usr/sbin/rpcinfo -p | grep mountd | grep udp | awk '{ print $4 }'%%)
    RULE(filter, INPUT, udp, @INTNET@, :1023, @INTIP@, @MOUNTDPORT@, @INTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, ACCEPT, YES)
    RULE(filter, OUTPUT, udp, @INTIP@, @MOUNTDPORT@, @INTNET@, :1023, IGNORE, @INTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, ACCEPT, YES)
  CONDMULTI-RULE(system, 2, %%LOCKPORT%%/usr/sbin/rpcinfo -p | grep nlockmgr | grep udp | awk '{ print $4 }'%%)
    RULE(filter, INPUT, udp, @INTNET@, :1023, @INTIP@, @LOCKPORT@, @INTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, ACCEPT, YES)
    RULE(filter, OUTPUT, udp, @INTIP@, @LOCKPORT@, @INTNET@, :1023, IGNORE, @INTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, ACCEPT, YES)
  CONDMULTI-RULE(system, 2, %%STATPORT%%/usr/sbin/rpcinfo -p | grep status | grep udp | awk '{ print $4 }'%%)
    RULE(filter, INPUT, udp, @INTNET@, :1023, @INTIP@, @STATPORT@, @INTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, ACCEPT, YES)
    RULE(filter, OUTPUT, udp, @INTIP@, @STATPORT@, @INTNET@, :1023, IGNORE, @INTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, ACCEPT, YES)
  CONDMULTI-RULE(system, 2, %%STATPORT%%/usr/sbin/rpcinfo -p | grep status | grep tcp | awk '{ print $4 }'%%)
    RULE(filter, INPUT, tcp, @INTNET@, :1023, @INTIP@, @STATPORT@, @INTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, ACCEPT, YES)
    RULE(filter, OUTPUT, tcp, @INTIP@, @STATPORT@, @INTNET@, :1023, IGNORE, @INTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, ACCEPT, YES)
}

outside -> firewall {
  RULE(filter, INPUT, tcp, @EXTNET@, 1024:, @EXTIP@, 111, @EXTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, NEW:RELATED:ESTABLISHED, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, ACCEPT, YES)
  RULE(filter, OUTPUT, tcp, @EXTIP@, 111, @EXTNET@, 1024:, IGNORE, @EXTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, RELATED:ESTABLISHED, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, NO, ACCEPT, YES)

  RULE(filter, INPUT, tcp, @EXTNET@, :1023, @EXTIP@, 2049, @EXTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, NEW:RELATED:ESTABLISHED, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, ACCEPT, YES)
  RULE(filter, OUTPUT, tcp, @EXTIP@, 2049, @EXTNET@, :1023, IGNORE, @EXTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, RELATED:ESTABLISHED, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, NO, ACCEPT, YES)
  RULE(filter, INPUT, udp, @EXTNET@, :1023, @EXTIP@, 2049, @EXTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, NEW:RELATED:ESTABLISHED, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, ACCEPT, YES)
  RULE(filter, OUTPUT, udp, @EXTIP@, 2049, @EXTNET@, :1023, IGNORE, @EXTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, RELATED:ESTABLISHED, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, ACCEPT, YES)

  CONDMULTI-RULE(system, 2, %%MOUNTDPORT%%/usr/sbin/rpcinfo -p | grep mountd | grep tcp | awk '{ print $4 }'%%)
    RULE(filter, INPUT, tcp, @EXTNET@, :1023, @EXTIP@, @MOUNTDPORT@, @EXTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, NEW:RELATED:ESTABLISHED, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, ACCEPT, YES)
    RULE(filter, OUTPUT, tcp, @EXTIP@, @MOUNTDPORT@, @EXTNET@, :1023, IGNORE, @EXTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, RELATED:ESTABLISHED, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, NO, ACCEPT, YES)
  CONDMULTI-RULE(system, 2, %%MOUNTDPORT%%/usr/sbin/rpcinfo -p | grep mountd | grep udp | awk '{ print $4 }'%%)
    RULE(filter, INPUT, udp, @EXTNET@, :1023, @EXTIP@, @MOUNTDPORT@, @EXTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, NEW:RELATED:ESTABLISHED, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, ACCEPT, YES)
    RULE(filter, OUTPUT, udp, @EXTIP@, @MOUNTDPORT@, @EXTNET@, :1023, IGNORE, @EXTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, RELATED:ESTABLISHED, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, ACCEPT, YES)
  CONDMULTI-RULE(system, 2, %%LOCKPORT%%/usr/sbin/rpcinfo -p | grep nlockmgr | grep udp | awk '{ print $4 }'%%)
    RULE(filter, INPUT, udp, @EXTNET@, :1023, @EXTIP@, @LOCKPORT@, @EXTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, NEW:RELATED:ESTABLISHED, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, ACCEPT, YES)
    RULE(filter, OUTPUT, udp, @EXTIP@, @LOCKPORT@, @EXTNET@, :1023, IGNORE, @EXTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, RELATED:ESTABLISHED, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, ACCEPT, YES)
  CONDMULTI-RULE(system, 2, %%STATPORT%%/usr/sbin/rpcinfo -p | grep status | grep udp | awk '{ print $4 }'%%)
    RULE(filter, INPUT, udp, @EXTNET@, :1023, @EXTIP@, @STATPORT@, @EXTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, NEW:RELATED:ESTABLISHED, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, ACCEPT, YES)
    RULE(filter, OUTPUT, udp, @EXTIP@, @STATPORT@, @EXTNET@, :1023, IGNORE, @EXTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, RELATED:ESTABLISHED, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, ACCEPT, YES)
  CONDMULTI-RULE(system, 2, %%STATPORT%%/usr/sbin/rpcinfo -p | grep status | grep tcp | awk '{ print $4 }'%%)
    RULE(filter, INPUT, tcp, @EXTNET@, :1023, @EXTIP@, @STATPORT@, @EXTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, NEW:RELATED:ESTABLISHED, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, ACCEPT, YES)
    RULE(filter, OUTPUT, tcp, @EXTIP@, @STATPORT@, @EXTNET@, :1023, IGNORE, @EXTDEV@, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, RELATED:ESTABLISHED, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, IGNORE, NO, ACCEPT, YES)
}
